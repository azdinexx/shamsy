{% comment %}
  Loading Screen - Optimized animation from center to top with fade
{% endcomment %}

{% if section.settings.enable_loading_screen %}
  <div id="loading-screen-{{ section.id }}" class="loading-screen" aria-hidden="true">
    <div class="loading-content">
      {% if section.settings.loading_logo != blank %}
        <div class="loading-logo">
          <img 
            src="{{ section.settings.loading_logo | image_url: width: 400 }}" 
            alt="{{ section.settings.loading_logo_alt | default: shop.name | escape }}"
            class="loading-logo-image"
            width="200"
            height="200"
            loading="eager"
            decoding="async">
        </div>
      {% endif %}
    </div>
  </div>

  <style>
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: #f3e9dc;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      opacity: 1;
      transition: opacity .2s ease-in-out;
      pointer-events: none;
      overflow: hidden;
    }

    .loading-content {
      width: 100%;
      height: 100%;
      position: relative;
      text-align: center;
    }

    .loading-logo {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
      will-change: transform, opacity;
    }

    .loading-logo.animate-to-header {
      animation: logoToTop 1.2s ease-in-out forwards;
    }

    @keyframes logoToTop {
      0% {
        top: 50%;
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
      100% {
        top: 50px;
        transform: translate(-50%, -50%) scale(0.3);
        opacity: 0;
        filter: blur(8px);
      }
    }

    .loading-logo-image {
      width: 200px;
      height: auto;
      max-width: 100%;
    }

    .loading-screen.hidden {
      opacity: 0;
      visibility: hidden;
    }

    @media (prefers-reduced-motion: reduce) {
      .loading-screen,
      .loading-logo,
      .loading-logo-image {
        transition: none !important;
        animation: none !important;
      }
      .loading-screen {
        opacity: 0;
        visibility: hidden;
      }
    }

    @media (max-width: 768px) {
      .loading-logo-image {
        width: 150px;
      }
      @keyframes logoToTop {
        0% {
          top: 50%;
          transform: translate(-50%, -50%) scale(1);
          opacity: 1;
        }
        100% {
          top: 30px;
          transform: translate(-50%, -50%) scale(0.25);
          opacity: 0;
          filter: blur(8px);
        }
      }
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const loadingScreen = document.getElementById('loading-screen-{{ section.id }}');
      const loadingLogo = document.querySelector('.loading-logo');
      const headerLogo = document.querySelector('.header-logo .logo-image');
      const reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      if (!loadingScreen || !loadingLogo) return;

      document.body.style.overflow = 'hidden';

      const hideLoadingScreen = () => {
        loadingScreen.classList.add('hidden');
        if (headerLogo) headerLogo.style.opacity = '1';
        document.body.style.overflow = '';
        setTimeout(() => {
          loadingScreen.style.display = 'none';
        }, 400); // Matches transition duration
      };

      if (reducedMotion) {
        hideLoadingScreen();
        return;
      }

      if (headerLogo) headerLogo.style.opacity = '0';

      // Start animation after a short delay
      requestAnimationFrame(() => {
        setTimeout(() => {
          loadingLogo.classList.add('animate-to-header');
        }, 500);
      });

      // Handle animation end
      loadingLogo.addEventListener('animationend', hideLoadingScreen, { once: true });

      // Fallback: hide loading screen after 3s if animation doesn't complete
      setTimeout(hideLoadingScreen, 3000);
    });
  </script>
{% endif %}

{% schema %}
{
  "name": "Loading Screen",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_loading_screen",
      "label": "Enable Loading Screen",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "loading_logo",
      "label": "Loading Logo"
    },
    {
      "type": "text",
      "id": "loading_logo_alt",
      "label": "Logo Alt Text"
    }
  ],
  "presets": [
    {
      "name": "Loading Screen"
    }
  ]
}
{% endschema %}